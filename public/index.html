<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zphs Nemmani - Login</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css?v=201">
    <style>
        body {
            /* Style.css handles the school background image */
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .login-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
            width: 100%;
            max-width: 420px;
            backdrop-filter: blur(5px);
        }
    </style>
</head>

<body>

    <div class="login-card">
        <h2 class="text-3xl font-bold text-center mb-2 text-green-700">Zphs Nemmani</h2>
        <p class="text-center text-gray-500 mb-6 text-sm">Enter Mobile Number to Join</p>

        <!-- Toggle Tabs -->
        <div class="flex justify-center mb-6 border-b border-gray-200">
            <button id="tab-login"
                class="w-1/2 pb-2 text-green-600 border-b-2 border-green-600 font-bold focus:outline-none transition-colors">Login</button>
            <button id="tab-register"
                class="w-1/2 pb-2 text-gray-500 hover:text-green-600 focus:outline-none transition-colors">New
                User</button>
        </div>

        <!-- Login Form -->
        <form id="login-form">
            <div class="mb-6">
                <label class="block text-gray-700 text-sm font-semibold mb-2">Mobile Number</label>
                <input type="tel" id="login-phone"
                    class="w-full px-4 py-3 rounded-lg bg-gray-50 border border-gray-300 focus:border-green-500 focus:bg-white focus:outline-none"
                    placeholder="10-digit mobile number" pattern="[6-9][0-9]{9}" maxlength="10"
                    oninput="this.value = this.value.replace(/[^0-9]/g, '');" required>
                <p class="text-xs text-gray-500 mt-1">Example: 9876543210</p>
            </div>
            <button type="submit"
                class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg focus:outline-none transition duration-300 shadow-md transform hover:-translate-y-1">
                Enter Chat
            </button>
        </form>

        <!-- Register Form -->
        <form id="register-form" class="hidden">
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-semibold mb-2">Your Name</label>
                <input type="text" id="reg-name"
                    class="w-full px-4 py-3 rounded-lg bg-gray-50 border border-gray-300 focus:border-blue-500 focus:bg-white focus:outline-none"
                    placeholder="Enter your full name" required>
            </div>
            <div class="mb-6">
                <label class="block text-gray-700 text-sm font-semibold mb-2">Mobile Number</label>
                <input type="tel" id="reg-phone"
                    class="w-full px-4 py-3 rounded-lg bg-gray-50 border border-gray-300 focus:border-blue-500 focus:bg-white focus:outline-none"
                    placeholder="10-digit mobile number" pattern="[6-9][0-9]{9}" maxlength="10"
                    oninput="this.value = this.value.replace(/[^0-9]/g, '');" required>
                <p class="text-xs text-gray-500 mt-1">Example: 9876543210</p>
            </div>
            <button type="submit"
                class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg focus:outline-none transition duration-300 shadow-md transform hover:-translate-y-1">
                Register & Join
            </button>
        </form>

        <p id="error-msg" class="text-red-500 text-sm font-medium mt-4 text-center"></p>
    </div>

    <script>
        const loginTab = document.getElementById('tab-login');
        const regTab = document.getElementById('tab-register');
        const loginForm = document.getElementById('login-form');
        const regForm = document.getElementById('register-form');
        const errorMsg = document.getElementById('error-msg');

        loginTab.onclick = () => {
            loginForm.classList.remove('hidden');
            regForm.classList.add('hidden');
            loginTab.classList.add('text-green-600', 'border-b-2', 'border-green-600', 'font-bold');
            loginTab.classList.remove('text-gray-500');
            regTab.classList.remove('text-green-600', 'border-b-2', 'border-green-600', 'font-bold');
            regTab.classList.add('text-gray-500');
            errorMsg.textContent = '';
        };

        regTab.onclick = () => {
            regForm.classList.remove('hidden');
            loginForm.classList.add('hidden');
            regTab.classList.add('text-green-600', 'border-b-2', 'border-green-600', 'font-bold');
            regTab.classList.remove('text-gray-500');
            loginTab.classList.remove('text-green-600', 'border-b-2', 'border-green-600', 'font-bold');
            loginTab.classList.add('text-gray-500');
            errorMsg.textContent = '';
        };

        // Handle Login
        loginForm.onsubmit = async (e) => {
            e.preventDefault();
            const phone = document.getElementById('login-phone').value;
            errorMsg.textContent = 'Connecting...';

            try {
                const res = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ phone })
                });
                const data = await res.json();
                if (data.success) {
                    localStorage.setItem('chatUser', JSON.stringify(data.user));
                    window.location.href = 'chat.html';
                } else {
                    errorMsg.textContent = data.error || 'User not found';
                }
            } catch (err) {
                console.error('Login error:', err);
                errorMsg.textContent = 'Server connection failed.';
            }
        };

        // Handle Register
        regForm.onsubmit = async (e) => {
            e.preventDefault();
            const name = document.getElementById('reg-name').value;
            const phone = document.getElementById('reg-phone').value;
            errorMsg.textContent = 'Creating account...';

            try {
                const res = await fetch('/api/auth/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ displayName: name, phone })
                });
                const data = await res.json();
                if (data.success) {
                    localStorage.setItem('chatUser', JSON.stringify(data.user));
                    window.location.href = 'chat.html';
                } else {
                    errorMsg.textContent = data.error || 'Registration failed';
                }
            } catch (err) {
                console.error('Register error:', err);
                errorMsg.textContent = 'Server connection failed.';
            }
        };
    </script>
</body>

</html>